exports.ids=[8],exports.modules={246:function(e,t,l){var content=l(248);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);var o=l(3).default;e.exports.__inject__=function(e){o("440f326c",content,!0,e)}},247:function(e,t,l){"use strict";l.r(t);var o=l(246),n=l.n(o);for(var r in o)"default"!==r&&function(e){l.d(t,e,(function(){return o[e]}))}(r);t.default=n.a},248:function(e,t,l){(t=l(2)(!1)).push([e.i,".sticky-header[data-v-06e5facb]{position:-webkit-sticky;position:sticky;top:0;z-index:10}.table[data-v-06e5facb]{max-height:700px}",""]),e.exports=t},249:function(e,t,l){"use strict";l.r(t);var o=l(4),n=l.n(o),r={name:"addRow",props:["show"],data:()=>({title:"",dateEvent:"",text:"",mark:0,recommendedAge:0,info:"",gender:"m",validation:{bank:0,town:0,title:0,text:0,service:0,channels:0,dateEvent:0},bankSelectModel:[],townSelectModel:[],channelsSelectModel:[],serviceSelectModel:[],channels:[],officeSelectModel:[],dispenserSelectModel:[]}),watch:{bankSelect(){this.bankSelectModel=[...this.bankSelect]},townSelect(){this.townSelectModel=[...this.townSelect]},officeSelect(){this.officeSelectModel=[...this.officeSelect]},bankSelectModel(){this.townSelectModel.forEach((e,i)=>{e.selected&&(this.townSelectModel[i].selected=!1)}),this.channelsSelectModel.forEach((e,i)=>{e.selected&&(this.channelsSelectModel[i].selected=!1)}),this.serviceSelectModel.forEach((e,i)=>{e.selected&&(this.channelsSelectModel[i].selected=!1)}),this.townSelect&&(this.townSelectModel=[...this.townSelect]),this.channelsSelect&&(this.channelsSelectModel=[...this.channelsSelect]),this.serviceSelect&&(this.serviceSelectModel=[...this.serviceSelect])},channelsSelectModel(){let e=this.channelsSelectModel.filter(e=>e.selected),t=[];e.forEach(e=>t.push(e.value)),t.length>0&&(this.channels=[...t]),this.officeSelect&&(this.officeSelectModel=[...this.officeSelect]),this.dispenserSelect&&(this.dispenserSelectModel=[...this.dispenserSelect])}},computed:{invalidFeedbackDateEvent(){return this.validation.dateEvent<2?"":2===this.validation.dateEvent?"Дата имеет неверный формат":void 0},invalidFeedbackBank(){return this.validation.bank<2?"":2===this.validation.bank?"Выберите банк":void 0},invalidFeedbackService(){return this.validation.service<2?"":2===this.validation.service?"Выберите услугу(и)":void 0},invalidFeedbackChannels(){return this.validation.service<2?"":2===this.validation.service?"Выберите канал(ы) взаимодействия":void 0},invalidFeedbackTown(){return this.validation.town<2?"":2===this.validation.town?"Выберите город":void 0},invalidFeedbackTitle(){return 2===this.validation.title?"Введите заголовок":3===this.validation.title?"Короткий заголовок":""},invalidFeedbackText(){return 2===this.validation.text?"Введите текст":3===this.validation.text?"Короткий текст":""},bankId(){if(this.bankSelectModel.some(e=>e.selected))return this.bankSelectModel.find(e=>e.selected)._id},officeId(){return this.officeSelectModel.some(e=>e.selected)?this.officeSelectModel.find(e=>e.selected)._id:0},dispenserId(){return this.dispenserSelectModel.some(e=>e.selected)?this.dispenserSelectModel.find(e=>e.selected)._id:0},townId(){if(this.townSelectModel.some(e=>e.selected))return this.townSelectModel.find(e=>e.selected)._id},townSelect(){return this.$store.getters["select/townSelectNew"](this.bankId)},officeSelect(){return this.bankId&&this.townId?this.$store.getters["select/officeSelectNew"](this.bankId,this.townId):[]},dispenserSelect(){return this.bankId&&this.townId?this.$store.getters["select/dispenserSelectNew"](this.bankId,this.townId):[]},serviceSelect(){return this.$store.getters["select/serviceSelect"]},service(){let e=[];return this.serviceSelectModel.filter(e=>e.selected).forEach(t=>e.push(t.value)),e},bankSelect(){return this.$store.getters["select/newBankSelect"]},channelsSelect(){return this.$store.getters["select/channelsSelect"]},town(){let e=this.townSelectModel.find(e=>e.selected);if(e)return e.value},bank(){let e=this.bankSelectModel.find(e=>e.selected);if(e)return e.value},office(){if(this.isOffice){let e=this.officeSelectModel.find(e=>e.selected);if(e)return e.value}},dispenser(){if(this.isDispenser){let e=this.dispenserSelectModel.find(e=>e.selected);if(e)return e.value}},isOffice(){return this.channelsSelectModel.some(e=>"Офис обслуживания / отделение"===e.value&&e.selected)},isDispenser(){return this.channelsSelectModel.some(e=>"Банкомат"===e.value&&e.selected)},date(){if(this.dateEvent.match("\\d{2}\\.\\d{2}\\.\\d{2,4}")){let e=this.dateEvent.split(".");switch(e[1]){case"01":e[1]="Января";break;case"02":e[1]="Февраля";break;case"03":e[1]="Марта";break;case"04":e[1]="Апреля";break;case"05":e[1]="Мая";break;case"06":e[1]="Июня";break;case"07":e[1]="Июля";break;case"08":e[1]="Августа";break;case"09":e[1]="Сентября";break;case"10":e[1]="Октября";break;case"11":e[1]="Ноября";break;case"12":e[1]="Декабря"}return`${e[0]} ${e[1]} ${e[2]}`}return this.dateEvent}},mounted(){this.bankSelectModel=[...this.bankSelect],this.townSelect&&this.townSelect.length>0&&(this.townSelectModel=[...this.townSelect]),this.channelsSelectModel=[...this.channelsSelect],this.serviceSelectModel=[...this.serviceSelect],this.officeSelectModel=[],this.dispenserSelectModel=[]},methods:{changeBank(){this.validateBank(),this.townSelectModel=[],this.townSelect&&this.townSelect.length>0&&(this.townSelectModel=[...this.townSelect])},changeTown(){this.validateTown()},channelsChange(){this.isDispenser||(this.dispenserSelectModel=[]),this.isOffice||(this.officeSelectModel=[]),this.validateChannels()},clearBank(){this.bankSelectModel=[],this.bankSelectModel=[...this.bankSelect],this.bankSelectModel.forEach((e,i)=>{this.bankSelectModel[i].selected&&(this.bankSelectModel[i].selected=!1)})},clearTownSelect(){this.townSelect&&(this.townSelectModel=[...this.townSelect])},clearService(){this.serviceSelectModel=[...this.serviceSelect]},setDefault(){this.clearBank(),this.clearTownSelect(),this.clearService(),this.title="",this.text="",this.mark=5,this.info="",this.gender="",this.recommendedAge=0},async save(){let e=this.channelsSelect.filter(e=>e.selected),t=[];if(e.forEach(e=>t.push(e.value)),this.validateTown(),this.validateTitle(),this.validateBank(),this.validateText(),this.validateService(),this.validateChannels(),this.validateDateEvent(),1!==this.validation.bank||1!==this.validation.service||1!==this.validation.text||1!==this.validation.title||1!==this.validation.town||1!==this.validation.channels||1!==this.validation.dateEvent||!this.mark)return this.$notify.error({title:"Ошибка при проверке",message:"Проверьте введенные данные"});const{bankId:l,title:title,text:text,mark:mark,info:o,gender:n,townId:r,recommendedAge:d,date:c,service:h,officeId:v,dispenserId:f}=this,{result:m}=(await this.$axios.post("/table/setTitleTextAndBank",{user:this.auth,bank:l,title:title,text:text,mark:mark,info:o,gender:n,town:r,recommendedAge:d,office:v,channels:t,dispenser:f,service:h,dateEvent:c})).data;m&&(this.$notify.success({title:"Удача",message:"Отзыв добавлен"}),this.$emit("reload-table"),this.setDefault(),this.$emit("close"))},validateBank(){this.bankId?this.validation.bank=1:this.validation.bank=2,this.$refs.bankSelect.validate()},validateTown(){this.townId?this.validation.town=1:this.validation.town=2,this.$refs.townSelect&&this.$refs.townSelect.validate()},validateTitle(){this.title?this.title.length<5?this.validation.title=3:this.validation.title=1:this.validation.title=2},validateText(){this.text?this.text.length<20?this.validation.text=3:this.validation.text=1:this.validation.text=2},validateService(){this.serviceSelectModel.some(e=>e.selected)?this.validation.service=1:this.validation.service=2,this.$refs.serviceSelect&&setTimeout(this.$refs.serviceSelect.validate,1)},validateChannels(){this.channelsSelectModel.some(e=>e.selected)?this.validation.channels=1:this.validation.channels=2,this.$refs.channelsSelect&&setTimeout(this.$refs.channelsSelect.validate,1)},validateDateEvent(){let e=this.dateEvent.trim();return 0===e.length||e.match("\\d{2}\\.\\d{2}\\.\\d{4}")?this.validation.dateEvent=1:this.validation.dateEvent=2}}},d=l(0);var c=Object(d.a)(r,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("mdb-modal",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}]},[l("mdb-modal-header",[e._v("\n      Добавление отзыва\n    ")]),e._v(" "),l("mdb-modal-body",[l("mdb-select",{ref:"bankSelect",attrs:{label:"Банк",customValidation:0!==e.validation.bank,isValid:1===e.validation.bank,search:"",visibleOptions:6,resetBtn:"",invalidFeedback:e.invalidFeedbackBank},on:{change:e.changeBank},model:{value:e.bankSelectModel,callback:function(t){e.bankSelectModel=t},expression:"bankSelectModel"}}),e._v(" "),e.bank?l("mdb-select",{ref:"townSelect",attrs:{label:"Город",customValidation:0!==e.validation.town,isValid:1===e.validation.town,resetBtn:"",invalidFeedback:e.invalidFeedbackTown},on:{change:e.changeTown},model:{value:e.townSelectModel,callback:function(t){e.townSelectModel=t},expression:"townSelectModel"}}):e._e(),e._v(" "),e.bank?l("mdb-select",{ref:"serviceSelect",attrs:{label:"Услуга(и)",search:"",multiple:"",customValidation:0!==e.validation.service,isValid:1===e.validation.service,resetBtn:"",invalidFeedback:e.invalidFeedbackService},on:{change:e.validateService},model:{value:e.serviceSelectModel,callback:function(t){e.serviceSelectModel=t},expression:"serviceSelectModel"}}):e._e(),e._v(" "),e.bank&&e.town?l("mdb-select",{ref:"channelsSelect",attrs:{multiple:"",search:"",label:"Каналы взаимодействия",placeholder:"Каналы взаимодействия",customValidation:0!==e.validation.channels,isValid:1===e.validation.channels,resetBtn:"",invalidFeedback:e.invalidFeedbackChannels},on:{change:e.channelsChange},model:{value:e.channelsSelectModel,callback:function(t){e.channelsSelectModel=t},expression:"channelsSelectModel"}}):e._e(),e._v(" "),e.town&&e.isOffice?l("mdb-select",{attrs:{label:"Отделение"},model:{value:e.officeSelectModel,callback:function(t){e.officeSelectModel=t},expression:"officeSelectModel"}}):e._e(),e._v(" "),e.town&&e.isDispenser?l("mdb-select",{attrs:{label:"Банкомат"},model:{value:e.dispenserSelectModel,callback:function(t){e.dispenserSelectModel=t},expression:"dispenserSelectModel"}}):e._e(),e._v(" "),l("mdb-input",{attrs:{type:"textarea",label:"Заголовок",customValidation:e.validation.title>0,isValid:1===e.validation.title,resetBtn:"",invalidFeedback:e.invalidFeedbackTitle},on:{change:e.validateTitle},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v(" "),l("mdb-input",{attrs:{type:"textarea",label:"Текст",customValidation:e.validation.text>0,isValid:1===e.validation.text,resetBtn:"",invalidFeedback:e.invalidFeedbackText},on:{change:e.validateText},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),e._v(" "),l("label",{attrs:{for:"markSelect"}},[e._v("Оценка")]),e._v(" "),l("mdb-form-inline",{staticClass:"was-validated",attrs:{id:"markSelect"}},[l("mdb-input",{attrs:{type:"radio",id:"option5-1",name:"groupOfMaterialRadios2",radioValue:1,label:"1",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option5-2",name:"groupOfMaterialRadios2",radioValue:2,label:"2",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option5-3",name:"groupOfMaterialRadios2",radioValue:3,label:"3",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option5-4",name:"groupOfMaterialRadios2",radioValue:4,label:"4",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option5-5",name:"groupOfMaterialRadios2",radioValue:5,label:"5",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}})],1),e._v(" "),l("mdb-input",{attrs:{label:"Дата события",small:"Формат ДД.ММ.ГГГГ",customValidation:e.validation.dateEvent>0,isValid:1===e.validation.dateEvent,resetBtn:"",invalidFeedback:e.invalidFeedbackDateEvent},on:{change:e.validateDateEvent},model:{value:e.dateEvent,callback:function(t){e.dateEvent=t},expression:"dateEvent"}}),e._v(" "),l("mdb-input",{attrs:{type:"textarea",label:"Дополнительная информация",styleComp:"width: 100%;"},model:{value:e.info,callback:function(t){e.info=t},expression:"info"}}),e._v(" "),l("mdb-input",{attrs:{type:"number",min:20,max:100,label:"Рекомендованный возраст"},model:{value:e.recommendedAge,callback:function(t){e.recommendedAge=t},expression:"recommendedAge"}}),e._v(" "),l("mdb-form-inline",[l("mdb-input",{attrs:{type:"radio",id:"option111-11",name:"groupOfMaterialRadios2232",radioValue:"m",label:"Мужчина"},model:{value:e.gender,callback:function(t){e.gender=t},expression:"gender"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option111-22",name:"groupOfMaterialRadios2123",radioValue:"f",label:"Женщина"},model:{value:e.gender,callback:function(t){e.gender=t},expression:"gender"}})],1)],1),e._v(" "),l("mdb-modal-footer",[l("mdb-btn",{staticClass:"modal-default-button-left",attrs:{color:"danger"},on:{click:function(t){return e.$emit("close")}}},[e._v("Отменить")]),e._v(" "),l("mdb-btn",{staticClass:"modal-default-button",on:{click:e.save}},[e._v("Добавить")])],1)],1)}),[],!1,(function(e){}),"5c881547","3f462f9c").exports,h={name:"assignProfile",props:["show","profiles","row"],data:()=>({profilesSelect:[]}),computed:{profileId(){let e=0;return this.profilesSelect.forEach(t=>{t.selected&&(e=t.value)}),e},user(){return this.$store.getters["auth/user"]}},watch:{row(){const e=this.row.gender;this.profilesSelect=[],this.row.profile?this.profiles.forEach(t=>{let l="m"===t.gender?"Мужской":"Женский";t.assigned||t.gender!==e?t._id===this.row.profile&&this.profilesSelect.push({text:`${t.FIO} (${t.mail} - ${t.age} лет - (${l}))`,value:t._id,selected:!0}):this.profilesSelect.push({text:`${t.FIO} (${t.mail} - ${t.age} лет - (${l}))`,value:t._id})}):this.profiles.forEach(t=>{let l="m"===t.gender?"Мужской":"Женский";t.assigned||t.gender!==e||this.profilesSelect.push({text:`${t.FIO} (${t.mail} - ${t.age} лет - (${l}))`,value:t._id})})}},methods:{async add(){const{profileId:e,row:t,user:l}=this,o=await this.$axios.post("/profile/assign",{user:l,rowId:t._id,profileId:e});o.data&&o.data.success&&(this.$emit("close"),this.$notify.success({title:"Профиль прикреплен"}),this.$emit("reload-table"))}}};var v=Object(d.a)(h,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("mdb-modal",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],on:{close:function(t){return e.$emit("close")}}},[l("mdb-modal-header",[e._v("\n    Прикрепить профиль к отзыву\n  ")]),e._v(" "),l("mdb-modal-body",[l("mdb-select",{directives:[{name:"show",rawName:"v-show",value:e.profilesSelect&&0!==e.profilesSelect.length,expression:"profilesSelect && profilesSelect.length !== 0"}],attrs:{search:""},model:{value:e.profilesSelect,callback:function(t){e.profilesSelect=t},expression:"profilesSelect"}}),e._v(" "),e.row&&e.row.assigned?l("mdb-btn",[e._v("Открепить")]):e._e(),e._v(" "),l("p",{directives:[{name:"show",rawName:"v-show",value:e.profilesSelect&&0===e.profilesSelect.length,expression:"profilesSelect && profilesSelect.length === 0"}]},[e._v("Не найдено профилей для данного отзыва")])],1),e._v(" "),l("mdb-modal-footer",[l("mdb-btn",{on:{click:e.add}},[e._v("Добавить")]),e._v(" "),l("mdb-btn",{on:{click:function(t){return e.$emit("close")}}},[e._v("Закрыть")])],1)],1)}),[],!1,(function(e){}),"a68eb4fc","5e85b1f8").exports,f=l(242),m=l.n(f),_={name:"datatable",props:["profiles","rows"],methods:{generateDate(e){let t=new Date(e);return m()(t,"dd.mm.yyyy")},momentSTR:e=>n()(e,"YYYY-MM-DD HH:mm").format("L"),getProfile(e){return this.profiles.find(t=>t._id===e.profile)},getLogin(e){if("string"==typeof e)return e.split("@")[0]}}};var w=Object(d.a)(_,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("b-table-simple",{staticClass:"table",attrs:{"no-border-collapse":"",responsive:"",stickyHeader:""}},[l("b-thead",[l("b-th",{staticClass:"sticky-header"},[e._v("#")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Создана запись")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Банк")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("email")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Фио")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Логин")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Пароль")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Ip")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Телефон")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("UserAgent")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Доп данные")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Пол")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Рекоммендуемый возраст")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Город")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Дата события")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Оценка")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Заголовок")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Текст")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Вопрос модератора")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Ответ модератору")]),e._v(" "),l("b-th",{staticClass:"sticky-header"},[e._v("Cтатус")])],1),e._v(" "),l("b-tbody",e._l(e.rows,(function(t){return e.rows&&e.rows.length>0?l("b-tr",[l("b-td",[e._v(e._s(t._id))]),e._v(" "),l("b-td",[e._v(e._s(e.generateDate(t.dateSetText,"YYYY-MM-DD HH:mm")))]),e._v(" "),l("b-td",[e._v(e._s(t.bank))]),e._v(" "),l("b-td",[t.profile&&e.getProfile(t)?l("span",[e._v(e._s(e.getProfile(t).mail))]):e._e()]),e._v(" "),l("b-td",[t.profile&&e.getProfile(t)?l("span",[e._v(e._s(e.getProfile(t).FIO))]):e._e()]),e._v(" "),l("b-td",[t.profile&&e.getProfile(t)?l("span",[e._v(e._s(e.getLogin(e.getProfile(t).mail)))]):e._e()]),e._v(" "),l("b-td",[t.profile&&e.getProfile(t)?l("span",[e._v(e._s(e.getLogin(e.getProfile(t).password)))]):e._e()]),e._v(" "),l("b-td"),e._v(" "),l("b-td"),e._v(" "),l("b-td"),e._v(" "),l("b-td",[e._v("\n        "+e._s(t.info)+"\n      ")]),e._v(" "),l("b-td",["m"===t.gender?l("span",[e._v("Мужской")]):l("span",[e._v("Женский")])]),e._v(" "),l("b-td",[e._v(e._s(t.recommendedAge))]),e._v(" "),l("b-td",[e._v(e._s(t.town))]),e._v(" "),l("b-td",[e._v(e._s(t.dateEvent))]),e._v(" "),l("b-td",[e._v(e._s(t.mark))]),e._v(" "),l("b-td",[e._v(e._s(t.title))]),e._v(" "),l("b-td",[e._v(e._s(t.text))]),e._v(" "),l("b-td"),e._v(" "),l("b-td"),e._v(" "),l("b-td",[l("div",[e.getProfile(t)?e.getProfile(t)?l("span",[e._v("Ожидает размещение")]):e._e():l("span",[e._v("Ожидает заполнение профиля")])])])],1):e._e()})),1)],1)}),[],!1,(function(e){var t=l(247);t.__inject__&&t.__inject__(e)}),"06e5facb","7514a3c4").exports,k={name:"updateRow",props:["row","show"],data:()=>({mounting:!0,bankSelectModel:[],townSelectModel:[],serviceSelectModel:[],channelsSelectModel:[],officeSelectModel:[],dispenserSelectModel:[],title:"",text:"",mark:0,dateEvent:"",recommendedAge:20,gender:"",info:"",validation:{bank:0,town:0,title:0,text:0,service:0,channels:0,dateEvent:0}}),mounted(){this.bankSelect&&(this.bankSelectModel=[...this.bankSelect],this.bankSelectModel.forEach((e,i)=>{e.selected&&(this.bankSelectModel[i].selected=!1),e._id===this.row.bank&&(this.bankSelectModel[i].selected=!0)})),this.townSelect&&(this.townSelectModel=[...this.townSelect],this.townSelectModel.forEach((e,i)=>{e.selected&&(this.townSelectModel[i].selected=!1),e._id===this.row.town&&(this.townSelectModel[i].index=i,this.townSelectModel[i].selected=!0)})),this.serviceSelect&&(this.serviceSelectModel=[...this.serviceSelect],this.serviceSelectModel.forEach((e,i)=>{e.selected&&(this.serviceSelectModel[i].selected=!1),this.row.service.some(t=>t===e.value)&&(this.serviceSelectModel[i].selected=!0)})),this.channelsSelect&&(this.channelsSelectModel=[...this.channelsSelect],this.channelsSelectModel.forEach((e,i)=>{e.selected&&(this.channelsSelectModel[i].selected=!1),this.row.channels.some(t=>t===e.value)&&(this.channelsSelectModel[i].selected=!0)})),this.officeSelect&&(this.officeSelectModel=[...this.officeSelect],this.officeSelectModel.forEach((e,i)=>{e.selected&&(this.officeSelectModel[i].selected=!1),this.row.office&&this.row.office===e._id&&(this.officeSelectModel[i].selected=!0)})),this.dispenserSelect&&(this.dispenserSelectModel=[...this.dispenserSelect],this.dispenserSelectModel.forEach((e,i)=>{e.selected&&(this.dispenserSelectModel[i].selected=!1),this.row.dispenser&&this.row.dispenser===e._id&&(this.dispenserSelectModel[i].selected=!0)})),this.title=this.row.title,this.text=this.row.text,this.mark=this.row.mark,this.row.recommendedAge&&(this.recommendedAge=this.row.recommendedAge),this.setDateEvent(),this.gender=this.row.gender,this.info=this.row.info,setTimeout(()=>{this.mounting=!1},100)},computed:{invalidFeedbackDateEvent(){return this.validation.dateEvent<2?"":2===this.validation.dateEvent?"Дата имеет неверный формат":void 0},invalidFeedbackBank(){return this.validation.bank<2?"":2===this.validation.bank?"Выберите банк":void 0},invalidFeedbackService(){return this.validation.service<2?"":2===this.validation.service?"Выберите услугу(и)":void 0},invalidFeedbackChannels(){return this.validation.service<2?"":2===this.validation.service?"Выберите канал(ы) взаимодействия":void 0},invalidFeedbackTown(){return this.validation.town<2?"":2===this.validation.town?"Выберите город":void 0},invalidFeedbackTitle(){return 2===this.validation.title?"Введите заголовок":3===this.validation.title?"Короткий заголовок":""},invalidFeedbackText(){return 2===this.validation.text?"Введите текст":3===this.validation.text?"Короткий текст":""},auth(){return this.$store.getters["auth/user"]},service(){let e=this.serviceSelectModel.filter(e=>e.selected),t=[];return e.forEach(e=>t.push(e.value)),t},office(){if(this.isOffice){let e=this.officeSelectModel.find(e=>e.selected);if(e)return e._id}},dispenser(){if(this.isDispenser){let e=this.dispenserSelectModel.find(e=>e.selected);if(e)return e._id}},bankId(){let e=this.bankSelectModel.find(e=>e.selected);if(e)return e._id},townId(){let e=this.townSelectModel.find(e=>e.selected);if(e)return e._id},bank(){let e=this.bankSelectModel.find(e=>e.selected);if(e)return e.value},bankSelect(){return this.$store.getters["select/newBankSelect"]},townSelect(){return this.$store.getters["select/townSelectNew"](this.bankId)},serviceSelect(){return this.$store.getters["select/serviceSelect"]},town(){let e=this.townSelectModel.find(e=>e.selected);if(e)return e.value},channelsSelect(){return this.$store.getters["select/channelsSelect"]},officeSelect(){return this.$store.getters["select/officeSelectNew"](this.bankId,this.townId)},dispenserSelect(){return this.$store.getters["select/dispenserSelectNew"](this.bankId,this.townId)},isOffice(){return this.channelsSelectModel.some(e=>"Офис обслуживания / отделение"===e.value&&e.selected)},isDispenser(){return this.channelsSelectModel.some(e=>"Банкомат"===e.value&&e.selected)},date(){if(this.dateEvent.match("\\d{2}\\.\\d{2}\\.\\d{2,4}")){let e=this.dateEvent.split(".");switch(e[1]){case"01":e[1]="Января";break;case"02":e[1]="Февраля";break;case"03":e[1]="Марта";break;case"04":e[1]="Апреля";break;case"05":e[1]="Мая";break;case"06":e[1]="Июня";break;case"07":e[1]="Июля";break;case"08":e[1]="Августа";break;case"09":e[1]="Сентября";break;case"10":e[1]="Октября";break;case"11":e[1]="Ноября";break;case"12":e[1]="Декабря"}return`${e[0]} ${e[1]} ${e[2]}`}return this.dateEvent}},methods:{changeTown(){this.validateTown()},clearTownSelect(){this.townSelect?(this.townSelectModel=[...this.townSelect],this.townSelectModel.forEach((e,i)=>{e.selected&&(this.townSelectModel[i].selected=!1)})):this.townSelectModel=[],this.validateTown()},clearChannelsSelect(){this.channelsSelect?(this.channelsSelectModel=[...this.channelsSelect],this.channelsSelectModel.forEach((e,i)=>{e.selected&&(this.channelsSelectModel[i].selected=!1)})):this.channelsSelectModel=[]},clearServiceSelect(){this.serviceSelect?(this.serviceSelectModel=[...this.serviceSelect],this.serviceSelectModel.forEach((e,i)=>{e.selected&&(this.serviceSelectModel[i].selected=!1)})):this.serviceSelectModel=[]},clearOfficeSelect(){this.officeSelect?(this.officeSelectModel=[...this.officeSelect],this.officeSelectModel.forEach((e,i)=>{e.selected&&(this.officeSelectModel[i].selected=!1)})):this.officeSelectModel=[]},clearDispenserSelect(){this.dispenserSelect?(this.dispenserSelectModel=[...this.dispenserSelect],this.dispenserSelectModel.forEach((e,i)=>{e.selected&&(this.dispenserSelectModel[i].selected=!1)})):this.dispenserSelectModel=[]},channelsChange(){this.isOffice||this.clearOfficeSelect(),this.isDispenser||this.clearDispenserSelect(),this.validateChannels()},changeBank(){this.mounting||(this.clearTownSelect(),this.clearChannelsSelect(),this.clearServiceSelect(),this.clearDispenserSelect(),this.clearOfficeSelect(),this.validateBank())},async update(){let e=this.channelsSelect.filter(e=>e.selected),t=[];if(e.forEach(e=>t.push(e.value)),this.validateTown(),this.validateTitle(),this.validateBank(),this.validateText(),this.validateService(),this.validateChannels(),this.validateDateEvent(),1!==this.validation.bank||1!==this.validation.service||1!==this.validation.text||1!==this.validation.title||1!==this.validation.town||1!==this.validation.channels||1!==this.validation.dateEvent||!this.mark)return this.$notify.error({title:"Ошибка при проверке",message:"Проверьте введенные данные"});const{bankId:l,title:title,text:text,mark:mark,info:o,gender:n,townId:r,recommendedAge:d,date:c,office:h,dispenser:v,service:f,row:m}=this,{result:_}=(await this.$axios.post("/table/updateReview",{user:this.auth,bank:l,title:title,text:text,mark:mark,info:o,gender:n,town:r,recommendedAge:d,office:h,channels:t,dispenser:v,service:f,dateEvent:c,_id:m._id})).data;_&&(this.$notify.success({title:"Удача",message:"Отзыв обновлен"}),this.$emit("reload-table"),this.$emit("close"))},setDateEvent(){let e=this.row.dateEvent.split(" ");if(3===e.length)switch(e[1]){case"Января":e[1]="01";break;case"Февраля":e[1]="02";break;case"Марта":e[1]="03";break;case"Апреля":e[1]="04";break;case"Мая":e[1]="05";break;case"Июня":e[1]="06";break;case"Июля":e[1]="07";break;case"Августа":e[1]="08";break;case"Сентября":e[1]="09";break;case"Октября":e[1]="10";break;case"Ноября":e[1]="11";break;case"Декабря":e[1]="12"}this.dateEvent=e.join(".")},validateBank(){this.bankId?this.validation.bank=1:this.validation.bank=2,this.$refs.bankSelect.validate()},validateTown(){this.townId?this.validation.town=1:this.validation.town=2,this.$refs.townSelect&&this.$refs.townSelect.validate()},validateTitle(){this.title?this.title.length<5?this.validation.title=3:this.validation.title=1:this.validation.title=2},validateText(){this.text?this.text.length<20?this.validation.text=3:this.validation.text=1:this.validation.text=2},validateService(){this.serviceSelectModel.some(e=>e.selected)?this.validation.service=1:this.validation.service=2,this.$refs.serviceSelect&&setTimeout(this.$refs.serviceSelect.validate,1)},validateChannels(){this.channelsSelectModel.some(e=>e.selected)?this.validation.channels=1:this.validation.channels=2,this.$refs.channelsSelect&&setTimeout(this.$refs.channelsSelect.validate,1)},validateDateEvent(){let e=this.dateEvent.trim();return 0===e.length||e.match("\\d{2}\\.\\d{2}\\.\\d{4}")?this.validation.dateEvent=1:this.validation.dateEvent=2}}};var S=Object(d.a)(k,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return e.row&&e.show?l("mdb-modal",[l("mdb-modal-header",[e._v("\n    Обновление отзыва\n  ")]),e._v(" "),l("mdb-modal-body",[l("form",{staticClass:"was-validated"},[l("mdb-select",{ref:"bankSelect",attrs:{label:"Банк",customValidation:0!==e.validation.bank,isValid:1===e.validation.bank,search:"",visibleOptions:6,resetBtn:"",invalidFeedback:e.invalidFeedbackBank},on:{change:e.changeBank},model:{value:e.bankSelectModel,callback:function(t){e.bankSelectModel=t},expression:"bankSelectModel"}}),e._v(" "),e.bank?l("mdb-select",{ref:"townSelect",attrs:{label:"Город",customValidation:0!==e.validation.town,isValid:1===e.validation.town,resetBtn:"",invalidFeedback:e.invalidFeedbackTown},on:{change:e.changeTown},model:{value:e.townSelectModel,callback:function(t){e.townSelectModel=t},expression:"townSelectModel"}}):e._e(),e._v(" "),e.bank?l("mdb-select",{ref:"serviceSelect",attrs:{label:"Услуга(и)",search:"",multiple:"",customValidation:0!==e.validation.service,isValid:1===e.validation.service,resetBtn:"",invalidFeedback:e.invalidFeedbackService},on:{change:e.validateService},model:{value:e.serviceSelectModel,callback:function(t){e.serviceSelectModel=t},expression:"serviceSelectModel"}}):e._e(),e._v(" "),e.bank&&e.town?l("mdb-select",{ref:"channelsSelect",attrs:{multiple:"",search:"",label:"Каналы взаимодействия",placeholder:"Каналы взаимодействия",customValidation:0!==e.validation.channels,isValid:1===e.validation.channels,resetBtn:"",invalidFeedback:e.invalidFeedbackChannels},on:{change:e.channelsChange},model:{value:e.channelsSelectModel,callback:function(t){e.channelsSelectModel=t},expression:"channelsSelectModel"}}):e._e(),e._v(" "),e.town&&e.isOffice?l("mdb-select",{attrs:{label:"Отделение",resetBtn:""},model:{value:e.officeSelectModel,callback:function(t){e.officeSelectModel=t},expression:"officeSelectModel"}}):e._e(),e._v(" "),e.town&&e.isDispenser?l("mdb-select",{attrs:{label:"Банкомат",resetBtn:""},model:{value:e.dispenserSelectModel,callback:function(t){e.dispenserSelectModel=t},expression:"dispenserSelectModel"}}):e._e(),e._v(" "),l("mdb-input",{attrs:{type:"textarea",label:"Заголовок",customValidation:e.validation.title>0,isValid:1===e.validation.title,resetBtn:"",invalidFeedback:e.invalidFeedbackTitle},on:{change:e.validateTitle},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v(" "),l("mdb-input",{attrs:{type:"textarea",label:"Текст",customValidation:e.validation.text>0,isValid:1===e.validation.text,resetBtn:"",invalidFeedback:e.invalidFeedbackText},on:{change:e.validateText},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),e._v(" "),l("label",{attrs:{for:"markSelectt"}},[e._v("Оценка")]),e._v(" "),l("mdb-form-inline",{staticClass:"was-validated",attrs:{id:"markSelectt"}},[l("mdb-input",{attrs:{type:"radio",id:"option5-111",name:"groupOfMaterialRadios2",radioValue:1,label:"1",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option5-2222",name:"groupOfMaterialRadios2",radioValue:2,label:"2",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option5-333",name:"groupOfMaterialRadios2",radioValue:3,label:"3",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option5-444",name:"groupOfMaterialRadios2",radioValue:4,label:"4",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option5-555",name:"groupOfMaterialRadios2",radioValue:5,label:"5",required:""},model:{value:e.mark,callback:function(t){e.mark=t},expression:"mark"}})],1),e._v(" "),l("mdb-input",{attrs:{label:"Дата события",small:"Формат ДД.ММ.ГГГГ",customValidation:e.validation.dateEvent>0,isValid:1===e.validation.dateEvent,resetBtn:"",invalidFeedback:e.invalidFeedbackDateEvent},on:{change:e.validateDateEvent},model:{value:e.dateEvent,callback:function(t){e.dateEvent=t},expression:"dateEvent"}}),e._v(" "),l("mdb-input",{attrs:{type:"textarea",label:"Дополнительная информация",styleComp:"width: 100%;"},model:{value:e.info,callback:function(t){e.info=t},expression:"info"}}),e._v(" "),l("mdb-input",{attrs:{type:"number",min:20,max:100,label:"Рекомендованный возраст"},model:{value:e.recommendedAge,callback:function(t){e.recommendedAge=t},expression:"recommendedAge"}}),e._v(" "),l("mdb-form-inline",[l("mdb-input",{attrs:{type:"radio",id:"option111-1111211",name:"groupOfMaterialRadios2232",radioValue:"m",label:"Мужчина"},model:{value:e.gender,callback:function(t){e.gender=t},expression:"gender"}}),e._v(" "),l("mdb-input",{attrs:{type:"radio",id:"option111-221213111",name:"groupOfMaterialRadios2123",radioValue:"f",label:"Женщина"},model:{value:e.gender,callback:function(t){e.gender=t},expression:"gender"}})],1)],1)]),e._v(" "),l("mdb-modal-footer",[l("mdb-btn",{staticClass:"modal-default-button-left",on:{click:function(t){return e.$emit("close")}}},[e._v("Отменить")]),e._v(" "),l("mdb-btn",{staticClass:"modal-default-button",on:{click:e.update}},[e._v("Обновить")])],1)],1):e._e()}),[],!1,(function(e){}),"8b216bca","d91ebb04").exports,x={name:"AddReview",props:["rows"],components:{UpdateRow:S,AddRow:c},data:()=>({showAddRowModal:!1,showUpdateRowModal:!1,updateRow:!1,updateRows:[]}),async mounted(){await this.$store.dispatch("select/loadAutoSelectBank")},computed:{filteredRows(){return this.rows.filter(e=>!e.profile&&1===e.step)},bankSelect(){return this.$store.getters["select/newBankSelect"]},townSelect(){return this.$store.getters["select/townSelectAll"]},channelsSelect(){return this.$store.getters["select/channelsSelect"]},dispenserSelect(){return this.$store.getters["select/dispenserSelectAll"]},officeSelect(){return this.$store.getters["select/officeSelectAll"]}},methods:{generateDate(e){let t=new Date(e);return m()(t,"dd.mm.yyyy")},setUpdateRow(e){this.showUpdateRowModal=!0,this.updateRow=e},momentSTR:e=>n()(e,"YYYY-MM-DD HH:mm").format("L"),getProfile(e){return this.profiles.find(t=>t._id===e.profile)},addUpdateRow(e){let t=[...this.bankSelect];t.forEach((l,i)=>{l.value===e.bank&&(t[i].selected=!0)});let l=[...this.townSelect];l.forEach((t,i)=>{t.value===e.town&&(l[i].selected=!0)});const o=[{text:1,value:1},{text:2,value:2},{text:3,value:3},{text:4,value:4},{text:5,value:5}];o.forEach((t,i)=>{t.value===e.mark&&(o[i].selected=!0)});const n=[{text:"Мужчина",value:"m"},{text:"Женщина",value:"f"}];n.forEach((t,i)=>{t.value===e.gender&&(n[i].selected=!0)});let r=[...this.channelsSelect];r.forEach((t,i)=>{e.channels.some(e=>t.value===e)&&(r[i].selected=!0)}),this.updateRows.push({bankSelect:t,townSelect:l,markSelect:o,genderSelect:n,channelsSelect:r,...e})},editing(e){return this.updateRows.some(t=>t._id===e._id)},getUpdateRow(e){return this.updateRows.find(t=>t._id===e._id)},cancelUpdate(e){this.updateRows=this.updateRows.filter(t=>t._id!==e._id)},prepareRowUpdate(e){let t=this.getUpdateRow(e);if(t.bankSelect.find(e=>e.selected)&&(t.bank=t.bankSelect.find(e=>e.selected).value),delete t.bankSelect,t.channelsSelect.some(e=>e.selected)){let e=t.channelsSelect.filter(e=>e.selected);t.channels=[],e.forEach(e=>t.channels.push(e.value))}if(delete t.channelsSelect,t.dateEvent.match("\\d{2}\\.\\d{2}\\.\\d{4}")){let e=t.dateEvent.split(".");switch(e[1]){case"01":e[1]="Января";break;case"02":e[1]="Февраля";break;case"03":e[1]="Марта";break;case"04":e[1]="Апреля";break;case"05":e[1]="Мая";break;case"06":e[1]="Июня";break;case"07":e[1]="Июля";break;case"08":e[1]="Августа";break;case"09":e[1]="Сентября";break;case"10":e[1]="Октября";break;case"11":e[1]="Ноября";break;case"12":e[1]="Декабря"}t.dateEvent=`${e[0]} ${e[1]} ${e[2]}`}return t.genderSelect.some(e=>e.selected)&&(t.gender=t.genderSelect.find(e=>e.selected).value),delete t.genderSelect,t.markSelect.some(e=>e.selected)&&(t.mark=t.markSelect.find(e=>e.selected).value),delete t.markSelect,t.townSelect.some(e=>e.selected)&&(t.town=t.townSelect.find(e=>e.selected).value),delete t.townSelect,t},async saveUpdate(e){const t=this.prepareRowUpdate(e);this.updateRows=this.updateRows.filter(t=>t._id!==e._id),(await this.$axios.post("/table/updateReview",{user:1,...t})).data.result&&this.$emit("reload-table")},async setNextStep(e){const{row:t}=(await this.$axios.post("/table/setStep2",{user:this.$store.getters["auth/user"],_id:e._id})).data;t&&this.$notify.success({title:"Успех",message:"Отзыв передан для создания профиля"}),this.$emit("reload-table")},getBankName(e){return this.bankSelect&&this.bankSelect.find(t=>t._id===e.bank)?this.bankSelect.find(t=>t._id===e.bank).text:""},getDispenser(e){return this.dispenserSelect&&e.dispenser&&this.dispenserSelect.find(t=>t._id===e.dispenser)?this.dispenserSelect.find(t=>t._id===e.dispenser).value:""},getOffice(e){return this.officeSelect&&e.office&&this.officeSelect.find(t=>t._id===e.office)?this.officeSelect.find(t=>t._id===e.office).value:""},getTown(e){return this.townSelect&&e.town&&this.townSelect.find(t=>t._id===e.town)?this.townSelect.find(t=>t._id===e.town).value:""},async deleteRow(e){const{success:t}=(await this.$axios.post("/table/deleteRow",{user:this.$store.getters["auth/user"],_id:e._id})).data;t&&(this.$notify.success({title:"Удалено"}),this.$emit("reload-table"))}}};var M=Object(d.a)(x,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("mdb-table",{attrs:{bordered:"",responsive:""}},[l("mdb-table-head",[l("tr",[l("th",[e._v("#")]),e._v(" "),l("th",[e._v("Создана запись")]),e._v(" "),l("th",[e._v("Банк")]),e._v(" "),l("th",[e._v("Адрес")]),e._v(" "),l("th",[e._v("Канал(ы) взаимодействия")]),e._v(" "),l("th",[e._v("Доп данные")]),e._v(" "),l("th",[e._v("Пол")]),e._v(" "),l("th",[e._v("Рекоммендуемый возраст")]),e._v(" "),l("th",[e._v("Город")]),e._v(" "),l("th",[e._v("Дата события")]),e._v(" "),l("th",[e._v("Оценка")]),e._v(" "),l("th",[e._v("Заголовок")]),e._v(" "),l("th",[e._v("Текст")]),e._v(" "),l("th",[e._v("Действия")])])]),e._v(" "),l("mdb-table-body",e._l(e.filteredRows,(function(t){return l("tr",[l("td",[e._v(e._s(t._id))]),e._v(" "),l("td",[e._v(e._s(e.generateDate(t.dateSetText)))]),e._v(" "),l("td",[e.editing(t)?l("mdb-select",{model:{value:e.getUpdateRow(t).bankSelect,callback:function(l){e.$set(e.getUpdateRow(t),"bankSelect",l)},expression:"getUpdateRow(row).bankSelect"}}):l("span",[e._v(e._s(e.getBankName(t)))])],1),e._v(" "),l("td",[t.office?l("p",[e._v("Офис - "+e._s(e.getOffice(t)))]):e._e(),e._v(" "),t.dispenser?l("p",[e._v("Банкомат - "+e._s(e.getDispenser(t)))]):e._e()]),e._v(" "),l("td",[e.editing(t)?l("mdb-select",{attrs:{multiple:""},model:{value:e.getUpdateRow(t).channelsSelect,callback:function(l){e.$set(e.getUpdateRow(t),"channelsSelect",l)},expression:"getUpdateRow(row).channelsSelect"}}):l("ul",e._l(t.channels,(function(t){return l("li",[e._v(e._s(t))])})),0)],1),e._v(" "),l("td",[e.editing(t)?l("mdb-input",{model:{value:e.getUpdateRow(t).info,callback:function(l){e.$set(e.getUpdateRow(t),"info",l)},expression:"getUpdateRow(row).info"}}):l("span",[e._v(e._s(t.info))])],1),e._v(" "),l("td",[e.editing(t)?l("mdb-select",{model:{value:e.getUpdateRow(t).genderSelect,callback:function(l){e.$set(e.getUpdateRow(t),"genderSelect",l)},expression:"getUpdateRow(row).genderSelect"}}):l("div",["m"===t.gender?l("span",[e._v("Мужской")]):l("span",[e._v("Женский")])])],1),e._v(" "),l("td",[e.editing(t)?l("mdb-input",{attrs:{type:"number",min:20,max:100},model:{value:e.getUpdateRow(t).recommendedAge,callback:function(l){e.$set(e.getUpdateRow(t),"recommendedAge",l)},expression:"getUpdateRow(row).recommendedAge"}}):l("span",[e._v(e._s(t.recommendedAge))])],1),e._v(" "),l("td",[e.editing(t)?l("mdb-select",{model:{value:e.getUpdateRow(t).townSelect,callback:function(l){e.$set(e.getUpdateRow(t),"townSelect",l)},expression:"getUpdateRow(row).townSelect"}}):l("span",[e._v(e._s(e.getTown(t)))])],1),e._v(" "),l("td",[e.editing(t)?l("mdb-input",{model:{value:e.getUpdateRow(t).dateEvent,callback:function(l){e.$set(e.getUpdateRow(t),"dateEvent",l)},expression:"getUpdateRow(row).dateEvent"}}):l("span",[e._v(e._s(t.dateEvent))])],1),e._v(" "),l("td",[e.editing(t)?l("mdb-select",{model:{value:e.getUpdateRow(t).markSelect,callback:function(l){e.$set(e.getUpdateRow(t),"markSelect",l)},expression:"getUpdateRow(row).markSelect"}}):l("span",[e._v(e._s(t.mark))])],1),e._v(" "),l("td",[e.editing(t)?l("mdb-input",{attrs:{type:"textarea"},model:{value:e.getUpdateRow(t).title,callback:function(l){e.$set(e.getUpdateRow(t),"title",l)},expression:"getUpdateRow(row).title"}}):l("span",[e._v(e._s(t.title))])],1),e._v(" "),l("td",[e.editing(t)?l("mdb-input",{attrs:{type:"textarea"},model:{value:e.getUpdateRow(t).text,callback:function(l){e.$set(e.getUpdateRow(t),"text",l)},expression:"getUpdateRow(row).text"}}):l("span",[e._v(e._s(t.text))])],1),e._v(" "),l("td",[l("mdb-btn",{attrs:{color:"primary",rounded:""},on:{click:function(l){return e.setUpdateRow(t)}}},[e._v("Изменить")]),e._v(" "),l("mdb-btn",{attrs:{color:"danger",rounded:""},on:{click:function(l){return e.deleteRow(t)}}},[e._v("Удалить")]),e._v(" "),l("mdb-btn",{attrs:{color:"success",rounded:""},on:{click:function(l){return e.setNextStep(t)}}},[e._v("На следующей шаг")])],1)])})),0)],1),e._ssrNode(" "),l("mdb-btn",{on:{click:function(t){e.showAddRowModal=!0}}},[e._v("Добавить запись")]),e._ssrNode(" "),l("add-row",{attrs:{show:e.showAddRowModal},on:{close:function(t){e.showAddRowModal=!1},"reload-table":function(t){return e.$emit("reload-table")}}}),e._ssrNode(" "),e.showUpdateRowModal?l("update-row",{attrs:{show:e.showUpdateRowModal,row:e.updateRow},on:{close:function(t){e.showUpdateRowModal=!1},"reload-table":function(t){return e.$emit("reload-table")}}}):e._e()],2)}),[],!1,(function(e){}),"bdbd2cc6","e3172bce").exports,y={name:"AddReview",props:["rows"],components:{AssignProfile:v,UpdateRow:S,AddRow:c},data:()=>({updateRow:!1,showAssignProfileModal:!1}),async mounted(){await this.$store.dispatch("select/loadAutoSelectBank")},computed:{profiles(){return this.$store.getters["profile/allProfiles"]},filteredRows(){return this.rows.filter(e=>2===e.step)},user(){return this.$store.getters["auth/user"]}},methods:{setShowAssignProfileModal(e){this.showAssignProfileModal=!0,this.updateRow=e},generateDate(e){let t=new Date(e);return m()(t,"dd.mm.yyyy")},momentSTR:e=>n()(e,"YYYY-MM-DD HH:mm").format("L"),async setNextStep(e){const{user:t}=this,{success:l}=(await this.$axios.post("/table/setStep3",{user:t,_id:e._id})).data;l&&this.$notify.success({title:"Успех",message:"Отзыв передан для добавления"}),this.$emit("reload-table")},async unpinProfile(e){const{user:t}=this,{success:l}=(await this.$axios.post("/profile/unpin",{user:t,_id:e._id})).data;l&&(this.$notify.success({title:"Профиль отпкреплен"}),this.$emit("reload-profiles"),this.$emit("reload-table"))}}};var $=Object(d.a)(y,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("mdb-table",{attrs:{bordered:"",responsive:""}},[l("mdb-table-head",[l("tr",[l("th",[e._v("#")]),e._v(" "),l("th",[e._v("Создана запись")]),e._v(" "),l("th",[e._v("Доп данные")]),e._v(" "),l("th",[e._v("Пол")]),e._v(" "),l("th",[e._v("Рекоммендуемый возраст")]),e._v(" "),l("th",[e._v("Заголовок")]),e._v(" "),l("th",[e._v("Текст")]),e._v(" "),l("th",[e._v("Действия")])])]),e._v(" "),l("mdb-table-body",e._l(e.filteredRows,(function(t){return l("tr",[l("td",[e._v(e._s(t._id))]),e._v(" "),l("td",[e._v(e._s(e.generateDate(t.dateSetText)))]),e._v(" "),l("td",[l("span",[e._v(e._s(t.info))])]),l("td",[l("div",["m"===t.gender?l("span",[e._v("Мужской")]):l("span",[e._v("Женский")])])]),e._v(" "),l("td",[l("span",[e._v(e._s(t.recommendedAge))])]),e._v(" "),l("td",[l("span",[e._v(e._s(t.title))])]),e._v(" "),l("td",[l("span",[e._v(e._s(t.text))])]),e._v(" "),l("td",[l("mdb-btn",{on:{click:function(l){return e.setShowAssignProfileModal(t)},close:function(t){e.showAssignProfileModal=!1}}},[t.profile?l("span",[e._v("Изменить профиль")]):l("span",[e._v("Прикрепить профиль")])]),e._v(" "),t.profile?l("mdb-btn",{attrs:{color:"danger",rounded:""},on:{click:function(l){return e.unpinProfile(t)}}},[e._v("Открепить профиль")]):e._e(),e._v(" "),t.profile?l("mdb-btn",{attrs:{color:"success",rounded:""},on:{click:function(l){return e.setNextStep(t)}}},[e._v("На следующей шаг")]):e._e()],1)])})),0)],1),e._ssrNode(" "),l("assign-profile",{attrs:{show:e.showAssignProfileModal,profiles:e.profiles,row:e.updateRow},on:{close:function(t){e.showAssignProfileModal=!1},"reload-table":function(t){return e.$emit("reload-table")}}})],2)}),[],!1,(function(e){}),"40d4eee0","7b9319a5").exports,R={name:"assignIpModal",props:["show","row"],computed:{user(){return this.$store.getters["auth/user"]},ips(){return this.$store.getters["ip/allIps"]},bankSelect(){return this.$store.getters["select/newBankSelect"]},townSelect(){return this.$store.getters["select/townSelectAll"]}},data:()=>({ipSelectModel:[]}),watch:{row(){this.ipSelectModel=[],this.ips.forEach(e=>{e.used?this.row.ip===e._id&&(this.ipSelectModel.push({text:`${e.ip} (${e.town})`,value:e._id,selected:!0}),console.log(this.row.ip===e._id)):this.ipSelectModel.push({text:`${e.ip} (${e.town})`,value:e._id})})}},methods:{getBankName(e){return this.bankSelect&&this.bankSelect.find(t=>t._id===e.bank)?this.bankSelect.find(t=>t._id===e.bank).text:""},getTown(e){return this.townSelect&&e.town&&this.townSelect.find(t=>t._id===e.town)?this.townSelect.find(t=>t._id===e.town).value:""},async save(){let e=this.ipSelectModel.find(e=>e.selected);if(!e)return;e=e.value;const{success:t}=(await this.$axios.post("/table/assignIp",{user:this.user,ip:e,_id:this.row._id})).data;t?this.$notify.success({title:"Успешно прявязан ip"}):this.$notify.success({title:"Ошибка привязки"})}}};var I=Object(d.a)(R,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("mdb-modal",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],on:{close:function(t){return e.$emit("close")}}},[l("mdb-modal-header",[e._v("\n    Привязка IP\n  ")]),e._v(" "),l("mdb-modal-body",[l("mdb-input",{attrs:{value:e.getBankName(e.row),disabled:"",label:"Банк"}}),e._v(" "),l("mdb-input",{attrs:{value:e.getTown(e.row),disabled:"",label:"Город"}}),e._v(" "),l("mdb-select",{attrs:{label:"Выбор ip"},model:{value:e.ipSelectModel,callback:function(t){e.ipSelectModel=t},expression:"ipSelectModel"}}),e._v(" "),l("mdb-btn",{on:{click:e.save}},[e._v("Сохранить")])],1)],1)}),[],!1,(function(e){}),"61ac42b1","29ec81fe").exports,T={name:"ipInfoModal",props:["show","row"],computed:{ips(){return this.$store.getters["ip/allIps"]},selectedIp(){return this.row.ip&&this.ips?this.ips.find(e=>e._id===this.row.ip):""}},methods:{doCopy:function(e){this.$copyText(e).then((function(e){alert("Copied"),console.log(e)}),(function(e){alert("Can not copy"),console.log(e)}))}}};var E=Object(d.a)(T,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("mdb-modal",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],on:{close:function(t){return e.$emit("close")}}},[l("mdb-modal-header",[e._v("\n    Инфо\n  ")]),e._v(" "),l("mdb-modal-body",[e.selectedIp?l("div",[l("mdb-input",{attrs:{value:e.selectedIp.string,disabled:"",label:"Строка"},nativeOn:{click:function(t){return e.doCopy(e.selectedIp.string)}}}),e._v(" "),e.selectedIp.userAgent?l("mdb-input",{attrs:{value:e.selectedIp.userAgent,disabled:"",label:"UserAgent"},nativeOn:{click:function(t){return e.doCopy(e.selectedIp.userAgent)}}}):e._e()],1):e._e()]),e._v(" "),l("mdb-modal-footer",[l("mdb-btn",{attrs:{color:"danger"},on:{click:function(t){return e.$emit("close")}}},[e._v("Закрыть")])],1)],1)}),[],!1,(function(e){}),"e2ca6904","7ba4189f").exports,A={name:"showRegisterModal",props:["show","row"],data:()=>({phone:""}),computed:{user(){return this.$store.getters["auth/user"]},profiles(){return this.$store.getters["profile/allProfiles"]},profile(){return this.profiles.find(e=>e._id===this.row.profile)}},watch:{row(){this.row.phone&&(this.phone=this.row.phone)}},methods:{doCopy:function(e){this.$copyText(e).then((function(e){alert("Copied"),console.log(e)}),(function(e){alert("Can not copy"),console.log(e)}))},async addPhone(){const{success:e}=(await this.$axios.post("/table/setPhone",{user:this.user,_id:this.row._id,phone:this.phone})).data;e?this.$notify.success({title:"Успех"}):this.$notify.error({title:"Ошибка"})}}};var O=Object(d.a)(A,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("mdb-modal",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],on:{close:function(t){return e.$emit("close")}}},[l("mdb-modal-header",[e._v("\n    Инфо\n  ")]),e._v(" "),l("mdb-modal-body",[e.profile?l("div",[l("mdb-input",{attrs:{value:e.profile.mail,disabled:"",label:"Почта"},nativeOn:{click:function(t){return e.doCopy(e.profile.mail)}}}),e._v(" "),l("mdb-input",{attrs:{value:e.profile.login,disabled:"",label:"Логин"},nativeOn:{click:function(t){return e.doCopy(e.profile.login)}}}),e._v(" "),l("mdb-input",{attrs:{value:e.profile.password,disabled:"",label:"Пароль"},nativeOn:{click:function(t){return e.doCopy(e.profile.password)}}}),e._v(" "),l("mdb-input",{attrs:{label:"Телефон",small:"начинается с +7"},model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}})],1):e._e()]),e._v(" "),l("mdb-modal-footer",[l("mdb-btn",{attrs:{color:"success"},on:{click:e.addPhone}},[e._v("Добавить")])],1)],1)}),[],!1,(function(e){}),"73ed1287","ec54ced2").exports,C={name:"createProfileInfo",props:["row"],computed:{profiles(){return this.$store.getters["profile/allProfiles"]},profile(){return this.profiles.find(e=>e._id===this.row.profile)}},methods:{doCopy:function(e){this.$copyText(e).then((function(e){}),(function(e){}))}}};var U=Object(d.a)(C,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return e.profile?l("div",[l("mdb-input",{attrs:{value:e.profile.FIO.split(" ")[0],label:"Фамилия",disabled:""},nativeOn:{click:function(t){e.doCopy(e.profile.FIO.split(" ")[0])}}}),e._ssrNode(" "),l("mdb-input",{attrs:{value:e.profile.FIO.split(" ")[1],label:"Имя",disabled:""},nativeOn:{click:function(t){e.doCopy(e.profile.FIO.split(" ")[1])}}}),e._ssrNode(" "),l("mdb-input",{attrs:{value:e.profile.FIO.split(" ")[2],label:"Отчество",disabled:""},nativeOn:{click:function(t){e.doCopy(e.profile.FIO.split(" ")[2])}}}),e._ssrNode(" "),l("mdb-input",{attrs:{value:e.profile.birthDate,label:"Дата рождения",disabled:""},nativeOn:{click:function(t){return e.doCopy(e.profile.birthDate)}}})],2):e._e()}),[],!1,(function(e){}),"1705900a","7cd1f725").exports,F={name:"reviewInfo",props:["row"],computed:{bankSelect(){return this.$store.getters["select/newBankSelect"]},officeSelect(){return this.$store.getters["select/officeSelectAll"]},dispenserSelect(){return this.$store.getters["select/dispenserSelectAll"]},office(){if(this.row.office)return this.officeSelect.find(e=>e._id===this.row.office)},dispenser(){if(this.row.dispenser)return this.dispenserSelect.find(e=>e._id===this.row.dispenser)},profiles(){return this.$store.getters["profile/allProfiles"]},profile(){return!!(this.profiles&&this.row.profile&&this.profiles.find(e=>e._id!==this.row.profile))&&this.profiles.find(e=>e._id===this.row.profile)}},methods:{getBankName(e){return this.bankSelect&&this.bankSelect.find(t=>t._id===e.bank)?this.bankSelect.find(t=>t._id===e.bank).text:""},getBankLink(e){return this.bankSelect&&this.bankSelect.find(t=>t._id===e.bank)?this.bankSelect.find(t=>t._id===e.bank).link:""},parsedGender:e=>"m"===e?"Мужской":"Женский",doCopy:function(e){this.$copyText(e).then((function(e){}),(function(e){}))},refactorBirthDate(e){switch((e=e.split("."))[1]){case"01":e[1]="Января";break;case"02":e[1]="Февраля";break;case"03":e[1]="Марта";break;case"04":e[1]="Апреля";break;case"05":e[1]="Мая";break;case"06":e[1]="Июня";break;case"07":e[1]="Июля";break;case"08":e[1]="Августа";break;case"09":e[1]="Сентября";break;case"10":e[1]="Октября";break;case"11":e[1]="Ноября";break;case"12":e[1]="Декабря"}return e.join(" ")}}};var B={name:"allInfo",props:["row","show"],components:{ReviewInfo:Object(d.a)(F,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return e.row?l("div",[e._ssrNode("<p data-v-74550388><span data-v-74550388>Банк - <a"+e._ssrAttr("href",e.getBankLink(e.row))+" data-v-74550388>"+e._ssrEscape(e._s(e.getBankName(e.row)))+'</a></span></p> <label for="channelsShow" data-v-74550388>Каналы вз-я</label> <ul id="channelsShow" data-v-74550388>'+e._ssrList(e.row.channels,(function(t){return"<li data-v-74550388>"+e._ssrEscape(e._s(t))+"</li>"}))+'</ul> <label for="address" data-v-74550388>Адреса</label> '),e._ssrNode('<ul id="address" data-v-74550388>',"</ul>",[e.row.office&&e.office?e._ssrNode("<li data-v-74550388>","</li>",[l("mdb-input",{attrs:{value:e.office.value,label:"Офис",disabled:""},nativeOn:{click:function(t){return e.doCopy(e.office.value)}}})],1):e._e(),e._ssrNode(" "),e.row.dispenser&&e.dispenser?e._ssrNode("<li data-v-74550388>","</li>",[l("mdb-input",{attrs:{value:e.dispenser.value,label:"Банкомат",disabled:""},nativeOn:{click:function(t){return e.doCopy(e.dispenser.value)}}})],1):e._e()],2),e._ssrNode(' <label for="servicesShow" data-v-74550388>Услуги</label> <ul id="servicesShow" data-v-74550388>'+e._ssrList(e.row.service,(function(t){return"<li data-v-74550388>"+e._ssrEscape(e._s(t))+"</li>"}))+"</ul> <p data-v-74550388>"+e._ssrEscape("Оценка    "+e._s(e.row.mark))+"</p> "),l("mdb-input",{attrs:{type:"textarea",value:e.row.title,disabled:"",label:"Заголовок"},nativeOn:{click:function(t){return e.doCopy(e.row.title)}}}),e._ssrNode(" "),l("mdb-input",{attrs:{type:"textarea",value:e.row.text,disabled:"",label:"Текст отзыва"},nativeOn:{click:function(t){return e.doCopy(e.row.text)}}}),e._ssrNode(" "),e.profile?e._ssrNode("<div data-v-74550388>","</div>",[l("mdb-input",{attrs:{value:e.profile.FIO,disabled:"",label:"ФИО"},nativeOn:{click:function(t){return e.doCopy(e.profile.FIO)}}}),e._ssrNode(" <span data-v-74550388>"+e._ssrEscape("Дата рождения "+e._s(e.refactorBirthDate(e.profile.birthDate)))+"</span>")],2):e._e(),e._ssrNode(" "),e.row.phone?l("mdb-input",{attrs:{value:e.row.phone,disabled:"",label:"Телефон"},nativeOn:{click:function(t){e.doCopy(e.row.phone.replace("+7",""))}}}):e._e(),e._ssrNode(" <span data-v-74550388>"+e._ssrEscape("Пол: "+e._s(e.parsedGender(e.row.gender)))+"</span> "),e.row.dateEvent?l("mdb-input",{attrs:{value:e.row.dateEvent,disabled:"",label:"Дата события"},nativeOn:{click:function(t){return e.doCopy(e.row.dateEvent)}}}):e._e()],2):e._e()}),[],!1,(function(e){}),"74550388","4e2e7e49").exports,CreateProfileInfo:U},data:()=>({profile:!0})};var D=Object(d.a)(B,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("mdb-modal",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],on:{close:function(t){return e.$emit("close")}}},[l("mdb-modal-header",[l("mdb-btn",{on:{click:function(t){e.profile=!0}}},[e._v("Профиль")]),e._v(" "),l("mdb-btn",{on:{click:function(t){e.profile=!1}}},[e._v("Отзыв")])],1),e._v(" "),l("mdb-modal-body",[e.row?l("div",[l("mdb-modal-body",[e.profile?l("create-profile-info",{attrs:{row:e.row}}):l("review-info",{attrs:{row:e.row}})],1)],1):e._e()]),e._v(" "),l("mdb-modal-footer",[l("mdb-btn",{attrs:{color:"danger"},on:{click:function(t){return e.$emit("close")}}},[e._v("Закрыть")])],1)],1)}),[],!1,(function(e){}),"e75dbfc0","0ee25348").exports,N={name:"addReviewLink",props:["show","row"],computed:{user(){if(this.$store.getters["auth/user"])return parseInt(this.$store.getters["auth/user"])}},data:()=>({link:""}),methods:{async save(){const{user:e,link:link}=this,{success:t}=(await this.$axios.post("table/setLink",{user:e,link:link,_id:this.row._id})).data;return t?this.$notify.success({title:"Успех"}):this.$notify.error({title:"Ошибка"})}}};var P={name:"addTechnical",components:{AddReviewLink:Object(d.a)(N,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("mdb-modal",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}]},[l("mdb-modal-header",[e._v("\n    Ссылка на отзыв\n  ")]),e._v(" "),e.show?l("mdb-modal-body",[l("mdb-input",{attrs:{label:"Ссылка"},model:{value:e.link,callback:function(t){e.link=t},expression:"link"}})],1):e._e(),e._v(" "),l("mdb-modal-footer",[l("mdb-btn",{on:{click:e.save}},[e._v("Сохранить")]),e._v(" "),l("mdb-btn",{attrs:{color:"danger"},on:{click:function(t){return e.$emit("close")}}},[e._v("Закрыть")])],1)],1)}),[],!1,(function(e){}),"8b0b7fc4","011c75a0").exports,AllInfo:D,ShowRegisterModal:O,IpInfoModal:E,AssignIpModal:I},props:["rows"],computed:{FilteredRows(){return this.rows.filter(e=>3===e.step)},bankSelect(){return this.$store.getters["select/newBankSelect"]},townSelect(){return this.$store.getters["select/townSelectAll"]},ipSelect(){return this.$store.getters["ip/allIps"]},user(){return this.$store.getters["auth/user"]}},data:()=>({selectedRow:!1,showAssignIpModal:!1,showIpInfoModal:!1,showRegisterModal:!1,showProfileAndReviewInfo:!1,showAddLinkModal:!1}),methods:{profileAndReviewInfo(e){this.showProfileAndReviewInfo=!0,this.selectedRow=e},showRegisterInfo(e){this.selectedRow=e,this.showRegisterModal=!0},setShowAddLinkModal(e){this.selectedRow=e,this.showAddLinkModal=!0},showIpInfo(e){this.selectedRow=e,this.showIpInfoModal=!0},showAssignIp(e){this.selectedRow=e,this.showAssignIpModal=!0},momentSTR:e=>n()(e,"YYYY-MM-DD HH:mm").format("L"),generateDate(e){let t=new Date(e);return m()(t,"dd.mm.yyyy")},getBankName(e){return this.bankSelect&&this.bankSelect.find(t=>t._id===e.bank)?this.bankSelect.find(t=>t._id===e.bank).text:""},getBankLink(e){return this.bankSelect&&this.bankSelect.find(t=>t._id===e.bank)?this.bankSelect.find(t=>t._id===e.bank).link:""},getTown(e){return this.townSelect&&e.town&&this.townSelect.find(t=>t._id===e.town)?this.townSelect.find(t=>t._id===e.town).value:""},getIp(e){return this.ipSelect&&e.ip&&this.ipSelect.find(t=>t._id===e.ip)?this.ipSelect.find(t=>t._id===e.ip).ip:""},async setBreakage(e){const{success:t}=(await this.$axios.post("/table/setBreakage",{user:this.user,_id:e._id})).data;return t?this.$notify.success({title:"Успех"}):this.$notify.error({title:"Ошибка"})},async setNextStep(e){const{row:t}=(await this.$axios.post("/table/setStep4",{user:this.$store.getters["auth/user"],_id:e._id})).data;t&&this.$notify.success({title:"Успех",message:"Отзыв передан для проверки"}),this.$emit("reload-table")},async unsignIp(e){const{success:t}=(await this.$axios.post("/table/unsignIp",{user:this.user,_id:e._id})).data;return t?this.$notify.success({title:"Успех"}):this.$notify.error({title:"Ошибка"})}}};var V=Object(d.a)(P,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("mdb-table",[l("mdb-table-head",[l("th",[e._v("#")]),e._v(" "),l("th",[e._v("Дата добавления")]),e._v(" "),l("th",[e._v("Банк")]),e._v(" "),l("th",[e._v("Город")]),e._v(" "),l("th",[e._v("Оценка")]),e._v(" "),l("th",[e._v("IP")]),e._v(" "),l("th",[e._v("Действия")])]),e._v(" "),l("mdb-table-body",e._l(e.FilteredRows,(function(t){return l("tr",[l("td",[e._v(e._s(t._id))]),e._v(" "),l("td",[e._v(e._s(e.generateDate(t.dateSetText)))]),e._v(" "),l("td",[e._v(e._s(e.getBankName(t)))]),e._v(" "),l("td",[e._v(e._s(e.getTown(t)))]),e._v(" "),l("td",[e._v(e._s(t.mark))]),e._v(" "),l("td",[e._v(e._s(e.getIp(t)))]),e._v(" "),l("td",[l("mdb-btn",{on:{click:function(l){return e.showAssignIp(t)}}},[e._v("Добавить профиль IP")]),e._v(" "),t.ip?l("mdb-btn",{on:{click:function(l){return e.showIpInfo(t)}}},[e._v("Данные об IP")]):e._e(),e._v(" "),t.ip?l("mdb-btn",{on:{click:function(l){return e.showRegisterInfo(t)}}},[e._v("Регистрация")]):e._e(),e._v(" "),t.phone?l("mdb-btn",{on:{click:function(l){return e.profileAndReviewInfo(t)}}},[e._v("Профиль/Отзыв")]):e._e(),e._v(" "),t.ip?l("mdb-btn",{on:{click:function(l){return e.setShowAddLinkModal(t)}}},[e._v("Прикрепить ссылку")]):e._e(),e._v(" "),t.reviewLink?l("mdb-btn",{on:{click:function(l){return e.setNextStep(t)}}},[e._v("К следущему шагу")]):e._e(),e._v(" "),l("mdb-btn",{attrs:{color:"danger"},on:{click:function(l){return e.setBreakage(t)}}},[e._v("Брак")]),e._v(" "),t.ip?l("mdb-btn",{on:{click:function(l){return e.unsignIp(t)}}},[e._v("Открепить IP")]):e._e()],1)])})),0)],1),e._ssrNode(" "),l("assign-ip-modal",{attrs:{show:e.showAssignIpModal,row:e.selectedRow},on:{close:function(t){e.showAssignIpModal=!1}}}),e._ssrNode(" "),l("ip-info-modal",{attrs:{show:e.showIpInfoModal,row:e.selectedRow},on:{close:function(t){e.showIpInfoModal=!1}}}),e._ssrNode(" "),l("show-register-modal",{attrs:{show:e.showRegisterModal,row:e.selectedRow},on:{close:function(t){e.showRegisterModal=!1}}}),e._ssrNode(" "),l("all-info",{attrs:{show:e.showProfileAndReviewInfo,row:e.selectedRow},on:{close:function(t){e.showProfileAndReviewInfo=!1}}}),e._ssrNode(" "),l("add-review-link",{attrs:{show:e.showAddLinkModal,row:e.selectedRow},on:{close:function(t){e.showAddLinkModal=!1}}})],2)}),[],!1,(function(e){}),"06490dbc","029bae8c").exports,L=l(245),Y=l.n(L),j={name:"showProfile",props:["show","row"],computed:{profiles(){return this.$store.getters["profile/allProfiles"]},profile(){if(this.row&&this.profiles&&this.row.profile)return this.profiles.find(e=>e._id===this.row.profile)}},methods:{doCopy:function(e){this.$copyText(e).then((function(e){}),(function(e){}))}}};var H=Object(d.a)(j,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("mdb-modal",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],on:{close:function(t){return e.$emit("close")}}},[l("mdb-modal-header",[e._v("\n    Профиль\n  ")]),e._v(" "),l("mdb-modal-body",[e.profile?l("div",[l("mdb-input",{attrs:{value:e.profile.FIO,disabled:"",label:"ФИО"},nativeOn:{click:function(t){return e.doCopy(e.profile.FIO)}}}),e._v(" "),l("mdb-input",{attrs:{value:e.profile.mail,disabled:"",label:"Почта"},nativeOn:{click:function(t){return e.doCopy(e.profile.mail)}}}),e._v(" "),l("mdb-input",{attrs:{value:e.profile.password,disabled:"",label:"Пароль"},nativeOn:{click:function(t){return e.doCopy(e.profile.password)}}}),e._v(" "),l("span",[e._v("При нажатии на любое поле значение автоматически копируется")])],1):e._e()]),e._v(" "),l("mdb-modal-footer")],1)}),[],!1,(function(e){}),"04852a9c","788c4694").exports,G={name:"checkBanModal",props:["show"],data:()=>({link:"",check:[]}),methods:{async checkBan(){const link=this.link;this.link="",this.check.push({link:link,loading:!0}),this.check=[...this.check];try{const{ban:e}=(await this.$axios.post("/parse/parse",{checkLink:link})).data;this.check=this.check.filter(e=>e.link!==link),this.check.push({link:link,loading:!1,ban:e}),this.check=[...this.check]}catch(e){this.check=this.check.filter(e=>e.link!==link),this.check.push({link:link,loading:!1,error:!0}),this.check=[...this.check]}}}};var z={name:"modarateTable",components:{CheckBanModal:Object(d.a)(G,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("mdb-modal",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],on:{close:function(t){return e.$emit("close")}}},[l("mdb-modal-header",[e._v("\n    Проверка на бан\n  ")]),e._v(" "),l("mdb-modal-body",[l("mdb-input",{attrs:{label:"Ссылка на отзыв",small:"Долгая проверка из-за тормознутости сайта banki"},model:{value:e.link,callback:function(t){e.link=t},expression:"link"}}),e._v(" "),l("div",[l("ul",e._l(e.check,(function(t){return l("li",[t.loading?l("span",[e._v(e._s(t.link)+" - "),l("div",{staticClass:"spinner-border",attrs:{role:"status"}},[l("span",{staticClass:"sr-only"},[e._v("Loading...")])])]):t.error?l("span",[e._v(e._s(t.link)+" - Что-то пошло не так")]):l("span",[e._v(e._s(t.link)+" - "),t.ban?l("span",[e._v("Бан")]):l("span",[e._v("Не бан")])])])})),0)])],1),e._v(" "),l("mdb-modal-footer",[l("mdb-btn",{on:{click:e.checkBan}},[e._v("Проверить")])],1)],1)}),[],!1,(function(e){}),"d1a5aedc","6986f464").exports,ShowProfile:H},props:["rows"],data:()=>({showProfileModal:!1,selectedRow:!1,showCheckBanned:!1,updateRows:[],StatusOne:!0,StatusTwo:!0,StatusThree:!0,StatusFour:!0,searchModel:"",fullText:{}}),watch:{StatusOne(e){localStorage.StatusOne=e},StatusTwo(e){localStorage.StatusTwo=e},StatusThree(e){localStorage.StatusThree=e},StatusFour(e){localStorage.StatusFour=e}},mounted(){setTimeout(()=>{localStorage.StatusOne&&"false"===localStorage.StatusOne&&(this.StatusOne=!1),localStorage.StatusTwo&&"false"===localStorage.StatusTwo&&(this.StatusTwo=!1),localStorage.StatusThree&&"false"===localStorage.StatusThree&&(this.StatusThree=!1),localStorage.StatusFour&&"false"===localStorage.StatusFour&&(this.StatusFour=!1)},100)},computed:{filteredRows(){let e=this.rows;return e=e.filter(e=>4===e.step),this.StatusOne||(e=e.filter(e=>1!==e.moderateStatus)),this.StatusTwo||(e=e.filter(e=>2!==e.moderateStatus)),this.StatusThree||(e=e.filter(e=>3!==e.moderateStatus)),this.StatusFour||(e=e.filter(e=>4!==e.moderateStatus)),this.StatusFive||(e=e.filter(e=>5!==e.moderateStatus)),this.searchModel&&(e=e.filter(e=>e.text.toLowerCase().includes(this.searchModel)||e.title.toLowerCase().includes(this.searchModel)||e.reviewLink.toLowerCase().includes(this.searchModel)||this.searchModel.toLowerCase().includes(e.reviewLink))),e.reverse()},profiles(){return this.$store.getters["profile/allProfiles"]},bankSelect(){return this.$store.getters["select/newBankSelect"]},user(){return this.$store.getters["auth/user"]}},methods:{mobile(){return Y()(this.navigator).phone},generateFullDate(e){let t=new Date(e);return m()(t,"dd.mm.yyyy HH:MM:ss")},getBankName(e){return this.bankSelect&&this.bankSelect.find(t=>t._id===e.bank)?this.bankSelect.find(t=>t._id===e.bank).text:""},getBankLink(e){return this.bankSelect&&this.bankSelect.find(t=>t._id===e.bank)?this.bankSelect.find(t=>t._id===e.bank).link:""},showProfile(e){this.selectedRow=e,this.showProfileModal=!0},getUpdateRowId(e){if(-1!==this.updateRows.findIndex(t=>t._id===e._id))return this.updateRows.findIndex(t=>t._id===e._id)},rowUpdate(e){if(-1!==this.updateRows.findIndex(t=>t._id===e._id))return!0},pushUpdateRow(e){console.log("dfdsfsdf");let t=[{text:"Ожидает проверку",value:1},{text:"Проверяется",value:2},{text:"Зачтен",value:3},{text:"Отклонен",value:4}];t.forEach((l,i)=>{l.value===e.moderateStatus&&(t[i].selected=!0)}),this.updateRows.push({_id:e._id,moderateStatusSelect:t,moderateAsk:e.moderateAsk,moderateAnswer:e.moderateAnswer})},getModerateStatus:e=>1===e.moderateStatus?"Ожидает проверку":2===e.moderateStatus?"Проверяется":3===e.moderateStatus?"Зачтен":4===e.moderateStatus?"Отклонен":void 0,cancelUpdate(e){this.updateRows=this.updateRows.filter(t=>t._id!==e._id)},generateDate(e){let t=new Date(e);return m()(t,"dd.mm.yyyy")},momentSTR:e=>n()(e,"YYYY-MM-DD HH:mm").format("L"),async save(e){const t=this.updateRows[this.getUpdateRowId(e)],l=t.moderateStatusSelect.find(e=>e.selected).value,{success:o}=(await this.$axios.post("/table/updateModerate",{user:this.user,_id:t._id,moderateStatus:l,moderateAnswer:t.moderateAnswer,moderateAsk:t.moderateAsk})).data;o?(this.$notify.success({title:"Изменено"}),this.cancelUpdate(e),this.$emit("reload-table")):this.$notify.error({title:"Что-то пошло не так!!!"})}}};var J={name:"Table",components:{ModarateTable:Object(d.a)(z,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("mdb-card-title",[l("mdb-btn",{on:{click:function(t){e.showCheckBanned=!0}}},[e._v("Проверка на бан")]),e._v(" "),l("mdb-form-inline",[l("mdb-input",{attrs:{type:"checkbox",id:"hideStatusOne",label:"Ожидает проверку"},model:{value:e.StatusOne,callback:function(t){e.StatusOne=t},expression:"StatusOne"}}),e._v(" "),l("mdb-input",{attrs:{type:"checkbox",id:"hideStatusTwo",label:"Проверяется"},model:{value:e.StatusTwo,callback:function(t){e.StatusTwo=t},expression:"StatusTwo"}}),e._v(" "),l("mdb-input",{attrs:{type:"checkbox",id:"hideStatusThree",label:"Зачтен"},model:{value:e.StatusThree,callback:function(t){e.StatusThree=t},expression:"StatusThree"}}),e._v(" "),l("mdb-input",{attrs:{type:"checkbox",id:"hideStatusFour",label:"Отклонен"},model:{value:e.StatusFour,callback:function(t){e.StatusFour=t},expression:"StatusFour"}})],1),e._v(" "),l("p",[l("mdb-input",{attrs:{type:"textarea",label:"Поиск"},model:{value:e.searchModel,callback:function(t){e.searchModel=t},expression:"searchModel"}})],1)],1),e._ssrNode(" "),l("mdb-card-body",[l("mdb-table",{attrs:{responsive:""}},[l("mdb-table-head",[l("th",[e._v("#")]),e._v(" "),l("th",[e._v("Дата")]),e._v(" "),l("th",[e._v("Дата добавления")]),e._v(" "),l("th",[e._v("Банк")]),e._v(" "),l("th",[e._v("Отзыв")]),e._v(" "),l("th",[e._v("Профиль")]),e._v(" "),l("th",[e._v("Заголовок")]),e._v(" "),l("th",[e._v("Текст")]),e._v(" "),l("th",[e._v("Вопрос модератора")]),e._v(" "),l("th",[e._v("Ответ")]),e._v(" "),l("th",[e._v("Стутус")]),e._v(" "),l("th",[e._v("Действия")])]),e._v(" "),l("mdb-table-body",e._l(e.filteredRows,(function(t){return l("tr",[l("td",[e._v(e._s(t._id))]),e._v(" "),l("td",[e._v(e._s(e.generateDate(t.dateSetText)))]),e._v(" "),l("td",[t.reviewAddDate?l("span",[e._v(e._s(e.generateFullDate(t.reviewAddDate)))]):l("span",[e._v("Еще не добавлен")])]),e._v(" "),l("td",[l("a",{attrs:{href:e.getBankLink(t),target:"_blank"}},[e._v(e._s(e.getBankName(t)))])]),e._v(" "),l("td",[l("a",{attrs:{href:t.reviewLink,target:"_blank"}},[e._v(e._s(t.reviewLink))])]),e._v(" "),l("td",[l("a",{attrs:{href:"#"},on:{click:function(l){return e.showProfile(t)}}},[e._v("Профиль")])]),e._v(" "),l("td",[e.fullText[t._id]?l("span",[e._v(e._s(t.title))]):l("span",[e.mobile()?l("mdb-btn",{on:{click:function(l){return e.$set(e.fullText,t._id,!0)}}},[e._v("Открыть")]):l("span",{on:{dblclick:function(l){return e.$set(e.fullText,t._id,!0)}}},[e._v("Открыть")])],1)]),e._v(" "),l("td",[e.fullText[t._id]?l("span",[e._v(e._s(t.text))]):l("span",[e.mobile()?l("mdb-btn",{on:{click:function(l){return e.$set(e.fullText,t._id,!0)}}},[e._v("Открыть")]):l("span",{on:{dblclick:function(l){return e.$set(e.fullText,t._id,!0)}}},[e._v("Открыть")])],1)]),e._v(" "),l("td",[!e.rowUpdate(t)&&t.moderateAsk?l("span",{on:{dblclick:function(l){return e.pushUpdateRow(t)}}},[e._v(" "+e._s(t.moderateAsk))]):e.rowUpdate(t)?l("mdb-input",{attrs:{type:"textarea"},model:{value:e.updateRows[e.getUpdateRowId(t)].moderateAsk,callback:function(l){e.$set(e.updateRows[e.getUpdateRowId(t)],"moderateAsk",l)},expression:"updateRows[getUpdateRowId(row)].moderateAsk"}}):l("span",{on:{dblclick:function(l){return e.pushUpdateRow(t)}}},[e._v("Добавить")])],1),e._v(" "),l("td",[!e.rowUpdate(t)&&t.moderateAnswer?l("span",{on:{dblclick:function(l){return e.pushUpdateRow(t)}}},[e._v(" "+e._s(t.moderateAnswer))]):e.rowUpdate(t)?l("mdb-input",{attrs:{type:"textarea"},model:{value:e.updateRows[e.getUpdateRowId(t)].moderateAnswer,callback:function(l){e.$set(e.updateRows[e.getUpdateRowId(t)],"moderateAnswer",l)},expression:"updateRows[getUpdateRowId(row)].moderateAnswer"}}):l("span",{on:{dblclick:function(l){return e.pushUpdateRow(t)}}},[e._v("Добавить")])],1),e._v(" "),l("td",[e.rowUpdate(t)?e._e():l("span",{on:{dblclick:function(l){return e.pushUpdateRow(t)}}},[e._v(e._s(e.getModerateStatus(t)))]),e._v(" "),e.rowUpdate(t)?l("mdb-select",{model:{value:e.updateRows[e.getUpdateRowId(t)].moderateStatusSelect,callback:function(l){e.$set(e.updateRows[e.getUpdateRowId(t)],"moderateStatusSelect",l)},expression:"updateRows[getUpdateRowId(row)].moderateStatusSelect"}}):e._e()],1),e._v(" "),l("td",[e.rowUpdate(t)?l("mdb-btn",{on:{click:function(l){return e.cancelUpdate(t)}}},[e._v("Отменить редактирование")]):e._e(),e._v(" "),e.rowUpdate(t)?l("mdb-btn",{attrs:{color:"success"},on:{click:function(l){return e.save(t)}}},[e._v("Сохранить")]):e._e()],1)])})),0)],1),e._v(" "),l("show-profile",{attrs:{show:e.showProfileModal,row:e.selectedRow},on:{close:function(t){e.showProfileModal=!1}}}),e._v(" "),l("check-ban-modal",{attrs:{show:e.showCheckBanned},on:{close:function(t){e.showCheckBanned=!1}}}),e._v(" "),l("client-only",[l("mdb-btn",[e._v(e._s(e.mobile()))])],1)],1)],2)}),[],!1,(function(e){}),"96b6839c","1ba64022").exports,AddTechnical:V,AssignProfileTable:$,AddReview:M,Datatable:w,AssignProfile:v,AddRow:c},data:()=>({showAddRowModal:!1,showUpdateReviewModal:!1,selectedRow:!1,onlyToday:!1,rowsUpdateActive:[],changes:{},ShowAssignModal:!1,assignRow:null}),computed:{rows(){return this.$store.getters["table/allTable"]},filteredData(){let e=this.rows;return this.onlyToday&&(e=e.filter(e=>this.momentSTR(e.dateSetText)===this.today)),e},today(){return this.momentSTR(new Date)},selectProfiles(){let e=[];return this.profiles.forEach(t=>{let l="m"===t.gender?"Мужчина":"Женщина";t.assigned||e.push({value:t._id,text:`${t.FIO} (${t.age} лет ${l})`})}),e},user(){if(this.$store.getters["auth/user"])return parseInt(this.$store.getters["auth/user"])},profiles(){return this.$store.getters["profile/allProfiles"]}},watch:{async user(){this.user&&(this.loadTable(),this.loadProfiles(),this.setIntervalReload())}},async mounted(){this.user&&(this.$store.dispatch("select/loadAutoSelectBank"),this.loadTable(),this.loadProfiles(),this.loadIP(),this.setIntervalReload()),"true"===localStorage.onlyToday&&(this.onlyToday=!0)},methods:{updateRows(data){console.log(data)},momentSTR:e=>n()(e,"YYYY-MM-DD HH:mm").format("L"),editReviewText(e){this.rowsUpdateActive.push(e._id);let t=[{text:"Москва",value:"Москва"},{text:"Санкт-Петербург",value:"Санкт-Петербург"},{text:"Ростов-на-Дону",value:"Ростов-на-Дону"}],l=[{text:"ТКБ",value:"ТКБ"},{text:"Возрождение",value:"Возрождение"},{text:"Дом.рф",value:"Дом.рф"}],o=[{text:"1",value:1},{text:"2",value:2},{text:"3",value:3},{text:"4",value:4},{text:"5",value:5}],n=e.dateEvent;n&&(n=n.replace(" Января ",".01."),n=n.replace(" Февраля ",".02."),n=n.replace(" Марта ",".03."),n=n.replace(" Апреля ",".04."),n=n.replace(" Мая ",".05."),n=n.replace(" Июня ",".06."),n=n.replace(" Июля ",".07."),n=n.replace(" Августа ",".08."),n=n.replace(" Сентября ",".09."),n=n.replace(" Октября ",".10."),n=n.replace(" Ноября ",".11."),n=n.replace(" Декабря ",".12.")),l.forEach((t,i)=>{t.value===e.bank&&(l[i].selected=!0)}),t.forEach((l,i)=>{l.value===e.town&&(t[i].selected=!0)}),o.forEach((t,i)=>{t.value===e.mark&&(o[i].selected=!0)}),console.log(l),this.changes[e._id]={...e,bankSelect:l,townSelect:t,markSelect:o},this.changes[e._id].dateEvent=n},async loadTable(){await this.$store.dispatch("table/load",this.user)},async loadProfiles(){await this.$store.dispatch("profile/load")},async loadIP(){await this.$store.dispatch("ip/loadAll")},toggleOnlyToday(){localStorage.onlyToday=`${this.onlyToday}`},changing(e){return this.rowsUpdateActive.some(t=>t===e._id)},assignProfile(e){this.ShowAssignModal=!0,this.assignRow=e},getProfile(e){return this.profiles.find(t=>t._id===e.profile)},getLogin(e){if("string"==typeof e)return e.split("@")[0]},setIntervalReload(){this.$store.dispatch("table/setInterval"),this.$store.dispatch("profile/setInterval"),this.$store.dispatch("ip/setInterval")}}},K=Object(d.a)(J,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[e._ssrNode("<p"+e._ssrStyle(null,null,{display:"none"})+">"+e._ssrEscape(e._s(e.user))+"</p> "),l("mdb-input",{attrs:{type:"checkbox",id:"checkbox1",name:"check1",label:"Только записи за сегодня"},on:{change:e.toggleOnlyToday},model:{value:e.onlyToday,callback:function(t){e.onlyToday=t},expression:"onlyToday"}}),e._ssrNode(" "),l("assign-profile",{attrs:{show:e.ShowAssignModal,profiles:e.selectProfiles,rows:e.assignRow},on:{close:function(t){e.ShowAssignModal=!1}}}),e._ssrNode(" "),l("add-review",{directives:[{name:"show",rawName:"v-show",value:1===e.user,expression:"user===1"}],attrs:{rows:e.rows},on:{"reload-table":e.loadTable}}),e._ssrNode(" "),l("assign-profile-table",{directives:[{name:"show",rawName:"v-show",value:2===e.user,expression:"user===2"}],attrs:{rows:e.rows},on:{"reload-table":e.loadTable,"reload-profiles":e.loadProfiles}}),e._ssrNode(" "),l("add-technical",{directives:[{name:"show",rawName:"v-show",value:3===e.user,expression:"user===3"}],attrs:{rows:e.rows},on:{"reload-table":e.loadTable}}),e._ssrNode(" "),l("modarate-table",{directives:[{name:"show",rawName:"v-show",value:4===e.user,expression:"user===4"}],attrs:{rows:e.rows},on:{"reload-table":e.loadTable}})],2)}),[],!1,null,null,"55ec1a54");t.default=K.exports}};